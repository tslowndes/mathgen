{% load filters %}
{% load static %}

<script src="https://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript" charset="utf-8"></script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};

window.onload = function() {
    var reloading = sessionStorage.getItem("reloading");

    if (reloading) {
        sessionStorage.removeItem("reloading");
        openExp();
    }

    var colour = $(".selected").css("background-color");

    // When clicking on colours items
    $(".controls").on("click", "li", function () {
        if ($(this).css("background-color") !== "rgba(0, 0, 0, 0)"){
                $(this).siblings().removeClass("selected");
                $(this).addClass("selected");
                colour = $(this).css("background-color");
        }
    });

    //for (var i = 0; i < 10; i++) {
    document.querySelectorAll('.canvases').forEach(canvas => {

        //var canvas = document.getElementById("mainCanvas".concat(i));
        var context = canvas.getContext("2d");
        var lastEvent;
        var mouseDown = false;

        // On mouse events on the canvas

        canvas.addEventListener("mousedown", function (e) {
            lastEvent = e;
            mouseDown = true;
        }, false);

        canvas.addEventListener("mousemove", function (e) {
            // Draw lines
            if (mouseDown) {
                context.beginPath();
                context.moveTo(lastEvent.offsetX, lastEvent.offsetY);
                context.lineTo(e.offsetX, e.offsetY);
                context.strokeStyle = colour;
                context.lineWidth = 5;
                context.lineCap = 'round';
                context.stroke();
                lastEvent = e;
            }
        }, false);

        canvas.addEventListener("mouseup", function (e) {
            mouseDown = false;
        }, false);

        canvas.addEventListener("mouseleave", function (e) {
            mouseDown = false;
        }, false);

        // Set up touch events for mobile, etc
        canvas.addEventListener("touchstart", function (e) {
        e.preventDefault();
                mousePos = getTouchPos(canvas, e);
          var touch = e.touches[0];
          var mouseEvent = new MouseEvent("mousedown", {
            clientX: touch.clientX,
            clientY: touch.clientY
          });
          canvas.dispatchEvent(mouseEvent);
          e.preventDefault();
        }, false);

        canvas.addEventListener("touchend", function (e) {
        e.preventDefault();
          var mouseEvent = new MouseEvent("mouseup", {});
          canvas.dispatchEvent(mouseEvent);
          e.preventDefault();
        }, false);

        canvas.addEventListener("touchmove", function (e) {
        e.preventDefault();
          var touch = e.touches[0];
          var mouseEvent = new MouseEvent("mousemove", {
            clientX: touch.clientX,
            clientY: touch.clientY
          });
          canvas.dispatchEvent(mouseEvent);
          e.preventDefault();
        }, false);

    //end of loop
    })

    // Get the position of a touch relative to the canvas
    function getTouchPos(canvasDom, touchEvent) {
      var rect = canvasDom.getBoundingClientRect();
      return {
        x: touchEvent.touches[0].clientX - rect.left,
        y: touchEvent.touches[0].clientY - rect.top
      };
    }

    // Prevent scrolling when touching the canvas
    document.body.addEventListener("touchstart", function (e) {
      if (e.target == canvas) {
        e.preventDefault();
      }
    }, false);

    document.body.addEventListener("touchend", function (e) {
      if (e.target == canvas) {
        e.preventDefault();
      }
    }, false);

    document.body.addEventListener("touchmove", function (e) {
      if (e.target == canvas) {
        e.preventDefault();
      }
    }, false);

    showSlides(slideIndex);

    }


function reloadP() {
    sessionStorage.setItem("reloading", "true");
    document.location.reload();
}

var slideIndex = 1;

// Next/previous controls
function plusSlides(n) {
  showSlides(slideIndex += n);
}

// Thumbnail image controls
function currentSlide(n) {
  showSlides(slideIndex = n);
}

function showSlides(n) {
  var i;
  var slides = document.getElementsByClassName("mySlides");
  if (n > slides.length) {slideIndex = slides.length}
  if (n < 1) {slideIndex = 1}
  for (i = 0; i < slides.length; i++) {
      slides[i].style.display = "none";
  }
  slides[slideIndex-1].style.display = "block";
  var no = document.getElementById("slidenumber")
  no.innerText = slideIndex.toString(10).concat(" / ").concat(slides.length)
}

  // Clear the canvas when button is clicked
function clear_canvas_width() {
    var s = document.getElementById("mainCanvas".concat(slideIndex-1));
    var w = s.width;
    s.width = 10;
    s.width = w;
}

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"></script>

<link rel="stylesheet" type="text/css" href="{% static 'polls/questions.css' %}">

<html>

  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
      <title>MATHGEN - {{title}}</title>
          <link rel="shortcut icon" type="image/x-icon" href="/media/favicon.ico" />
      <style>
        body {
          font-family: 'Lato', sans-serif;
        }

        .overlay {
          height: 100%;
          width: 0;
          position: fixed;
          z-index: 1;
          top: 0;
          left: 0;
          background-color: rgb(0,0,0);
          background-color: rgba(0,0,0, 1);
          overflow-x: hidden;
          transition: 0.5s;
        }

        .overlay-content {
          position: relative;
          top: 25%;
          width: 100%;
          text-align: center;
          margin-top: 30px;
        }

        .overlay a {
          padding: 8px;
          text-decoration: none;
          font-size: 36px;
          color: #818181;
          display: block;
          transition: 0.3s;
        }

        .overlay a:hover, .overlay a:focus {
          color: #f1f1f1;
        }

        .overlay .closebtn {
          position: absolute;
          top: 0vh;
          right: 2vw;
          font-size: 60px;
        }

        @media screen and (max-height: 450px) {
          .overlay a {font-size: 20px}
          .overlay .closebtn {
          font-size: 40px;
          top: 15px;
          right: 35px;
          }
        }
        #grid {
                display: grid;
                grid-template-columns: 5% 45%  5% 45%;
                width: 96%;
                height: 78vh;
                color: black;
                font-size: 32px;
                text-align: center;
                vertical-align: top;
                align-items: top;
                grid-template-rows: {% for row in rows %} {{row_height}}vh {% endfor %};
                margin: 2%;

            }
* {box-sizing:border-box}

/* Slideshow container */
.slideshow-container {
  max-width: 100%;
  position: relative;
  margin: auto;
}

/* Hide the images by default */
.mySlides {
  display: none;
}

/* Next & previous buttons */
.prev, .next {
  cursor: pointer;
  position: absolute;
  top: 50vh;
  width: auto;
  margin-top: 0px;
  padding: 16px;
  color: white;
  font-weight: bold;
  font-size: 18px;
  transition: 0.6s ease;
  border-radius: 0 3px 3px 0;
  user-select: none;
}

/* Position the "next button" to the right */
.next {
  right: 0;
  border-radius: 3px 0 0 3px;
}

/* On hover, add a black background color with a little bit see-through */
.prev:hover, .next:hover {
  background-color: rgba(0,0,0,0.8);
}
/* Caption text */
.text {
  color: #f2f2f2;
  font-size: 15px;
  padding: 8px 12px;
  position: absolute;
  bottom: 8px;
  width: 100%;
  text-align: center;
}

/* Number text (1/3 etc) */
.numbertext {
  color: #f2f2f2;
  font-size: 12px;
  padding: 8px 12px;
  position: absolute;
  top: 0;
}

/* The dots/bullets/indicators */
.dot {
  cursor: pointer;
  height: 15px;
  width: 15px;
  margin: 0 2px;
  background-color: #bbb;
  border-radius: 50%;
  display: inline-block;
  transition: background-color 0.6s ease;
}

.active, .dot:hover {
  background-color: #717171;
}

/* Fading animation */
.fade {
  -webkit-animation-name: fade;
  -webkit-animation-duration: 1.5s;
  animation-name: fade;
  animation-duration: 1.5s;
}

@-webkit-keyframes fade {
  from {opacity: .4}
  to {opacity: 1}
}

@keyframes fade {
  from {opacity: .4}
  to {opacity: 1}
}
      </style>
      <script>
            function openAns() {
              document.getElementById("answer_overlay").style.width = "100%";
            }

            function closeAns() {
              document.getElementById("answer_overlay").style.width = "0%";
            }

            function openExp() {
              document.getElementById("example_overlay").style.width = "100%";
            }

            function closeExp() {
              document.getElementById("example_overlay").style.width = "0%";
            }

        </script>
    <meta charset="utf-8">
  </head>

  <body style="background-color:#bcdff5;">

        <!-- Header Block -->
          <div id="grid" style="margin:0 0 0 0; grid-template-columns:70% 30%; width: 100vw; height:8vh; background-color:rgba(255,255,255,0.1); color:black; text-align:left; font-size:36; font-weight:400;">
              <div style="padding:1.5vh 0 0 2vw;">{{title}}</div>
              <div style="padding:1.5vh 0 0 2vw; text-align:right;"><a href="/sub/?task={{task_code}}"  class="button1" style="font-size:2.5vh;">{{strand}}</a><a href="/"  class="button1" style="font-size:2.5vh;">Home</a></div>
          </div>

        <!-- Question grid -->
        {% if imgs|lookup:0 == 0 %}
            <div id="grid" style="grid-template-columns: 5% 45% 5% 45%; padding:0; width: 96%; font-size:36px;">
        {% else %}
            <div id="grid" style="grid-template-columns: 5% 20% 5% 20% 5% 20% 5% 20%; padding:0; width: 96%; font-size:36px;">
        {% endif %}

        {% for i in count %}

            {% if imgs|lookup:i == 0 %}

                {% if questions|lookup:i|first_char:0 == "$" %}
                    <div style="text-align:center;">({{alphas|lookup:i}})</div><div style="font-size:5vh;">{{questions|lookup:i|linebreaksbr}}</div>
                {% else %}
                    <!--<div style="text-align:center;">({{alphas|lookup:i}})</div><div style="font-size:30px;">{{questions|lookup:i|linebreaksbr}}</div>-->
                    <div style="text-align:center;">({{alphas|lookup:i}})</div><div style={{questions|lookup:i|get_font_size:0}}>{{questions|lookup:i|linebreaksbr}}</div>
                {% endif %}

            {% else %}
                <div style="text-align:center;">({{alphas|lookup:i}})</div><div><img src="/media/{{questions|lookup:i}}" style="height:auto;"></div>

            {% endif %}

        {% endfor %}

      </div>


        <!-- Answers Overlay -->
      <div id="answer_overlay" class="overlay" style="background-color:#bcdff5;">
        <a href="javascript:void(0)" class="closebtn" onclick="closeAns()">&times;</a>

        <p class="overlay-content">

        <div id="grid" style="width:100vw; margin: 13vh 0 0 0; font-size:36px;">

            {% for i in count %}
                <div>({{alphas|lookup:i}})</div><div>{{answers|lookup:i}}</div>
            {% endfor %}

        </div>
      </div>
        {% if strand == "Starters" %}
            <div></div>
        {% else %}

        <!-- Example Overlay -->
        <div id="example_overlay" class="overlay" style="color:rgba(0,0,0,1); background-color:white;">

<div class="slideshow-container">

 {% for i in count %}

<div class="mySlides fade">

<canvas	class="canvases" width="4000px" height="4000px" style="background:transparent; position: absolute; top: -50;z-index:1;" id="mainCanvas{{i}}"></canvas>

            <div id="grid" style="position: absolute; z-index: 0; color: black; grid-template-columns:50% 50%; grid-template-rows: 50% 50%; height:20vh; align-items: center ; width:100vw; margin: 0vh 0 0 0">
                <div style="height:15vh; text-align:center; border-right: 0px solid black;">
                    <h2>My Go</h2>
                </div>
                <div style="height:15vh; text-align:center; border-bottom: 0px solid black; border-left: 0px solid black;">
                    <h2>Your Go</h2>
                </div>
                <div style="padding: 5px 5px 5px 5px; height:15vh; font-size:35px; border-right: 3px solid black;">
                    {% if imgs|lookup:i == 0 %}
                        {{examples|lookup:i}}
                    {% else %}
                        <img src="/media/{{examples|lookup:i}}" style="width=40vw;">
                    {% endif %}
                </div>
                <div style="padding: 5px 5px 5px 5px; border-left: 0px solid black; height:15vh; font-size:35px; ">
                    {% if imgs|lookup:i == 0 %}
                        {{yourgos|lookup:i}}
                    {% else %}
                        <img src="/media/{{yourgos|lookup:i}}" style="width=40vw;">
                    {% endif %}
                </div>
                <div style="height:70vh;border-right: 3px solid black;"> </div><div style="height:100px;"> </div>

            </div>
 </div>
 {% endfor %}
  <a class="prev" onclick="plusSlides(-1)" style="z-index:2;">&#10094;</a>
  <a class="next" onclick="plusSlides(1)" style="z-index:2;">&#10095;</a>
</div>

            <div class="controls" style="position:absolute; z-index:2; align-items: center; width:100%; top:90vh;">
                <ul>
                    <li class="red selected"></li>
                    <li class="blue"></li>
                    <li class="yellow"></li>
                    <li class="green"></li>
                    <li class="eraser" style="background: url('/media/eraserB.png') no-repeat center center; background-size:40px;" onclick='clear_canvas_width ()'></li>
                    <li class="refresh" style="background: url('/media/refreshB.png') no-repeat center center; background-size:40px;" onclick="reloadP();"></li>
                </ul>
            </div>
            <h2 id="slidenumber" style="position:absolute; bottom:0px; right:0;"> slides </h2>
            <a href="javascript:void(0)" class="closebtn" onclick="closeExp()" style="z-index:5;">&times;</a>

            <!--<script src="{% static 'polls/app.js' %}" type="text/javascript" charset="utf-8"></script>-->
      </div>


        {% endif %}

        <!-- Footer Grid -->
      <div id="grid" style = "grid-template-columns:20% 60% 20%; height:5vh; margin: 0 2% 0 2%">
          <div style="text-align:left;">
              <img src="/media/mathgen.png" style="height:5vh;">
          </div>

          <div style="text-align: center;">

            <a href=# onclick="openAns()" class="button1" style="font-size:2.5vh;">Answers</a>
              {% if strand != "Starters" %}
                <a href=# onclick="openExp()" class="button1" style="font-size:2.5vh;">Example</a>
              {% endif %}
              <a href=# onclick="window.location.reload();" class="button1" style="font-size:2.5vh;">New Qs</a>


          </div>

          <div></div>
      </div>



  </body>
</html>
